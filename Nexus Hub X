local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

-- Main Window with Key
local Window = Rayfield:CreateWindow({
    Name = "Nexus Hub v1.0 ☄️",
    LoadingTitle = "Loading...",
    LoadingSubtitle = "by Hydra",
    ConfigurationSaving = { Enabled = true },
    KeySystem = true,
    KeySettings = {
        Title = "Hub Key",
        Subtitle = "Enter the access key",
        FileName = "HydraKey",
        SaveKey = false,
        Key = "MYBF"
    }
})

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer

-- Flags
local playerEnabled = false
local autoPlayEnabled = false
local noclipEnabled = false
local infJumpEnabled = false

local cframeSpeed = 1
local gravity = 196.2

-- Player Tab
local PlayerTab = Window:CreateTab("Player", 4483362458)

PlayerTab:CreateToggle({
    Name = "Enable Player",
    CurrentValue = false,
    Callback = function(v) playerEnabled = v end
})

PlayerTab:CreateSlider({
    Name = "CFrame Speed",
    Range = {1, 100},
    Increment = 1,
    CurrentValue = 1,
    Callback = function(v) cframeSpeed = v end
})

PlayerTab:CreateSlider({
    Name = "Gravity",
    Range = {0, 500},
    Increment = 1,
    CurrentValue = 196,
    Callback = function(v)
        gravity = v
        if playerEnabled then workspace.Gravity = v end
    end
})

PlayerTab:CreateToggle({
    Name = "Enable Noclip",
    CurrentValue = false,
    Callback = function(v)
        noclipEnabled = v
    end
})

PlayerTab:CreateToggle({
    Name = "Enable InfJump",
    CurrentValue = false,
    Callback = function(v)
        infJumpEnabled = v
    end
})

-- Noclip implementation
RunService.Stepped:Connect(function()
    if noclipEnabled then
        local char = LocalPlayer.Character
        if char then
            for _, part in pairs(char:GetDescendants()) do
                if part:IsA("BasePart") then
                    part.CanCollide = false
                end
            end
        end
    end
end)

-- InfJump implementation
UserInputService.JumpRequest:Connect(function()
    if infJumpEnabled and LocalPlayer.Character then
        local hum = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
        if hum then
            hum:ChangeState(Enum.HumanoidStateType.Jumping)
        end
    end
end)

-- Player Movement with CFrame Bypass (slower)
RunService.Heartbeat:Connect(function()
    if not playerEnabled then return end

    local char = LocalPlayer.Character
    local hrp = char and char:FindFirstChild("HumanoidRootPart")
    local hum = char and char:FindFirstChildOfClass("Humanoid")
    if not hrp or not hum then return end

    workspace.Gravity = gravity

    local moveDir = hum.MoveDirection
    if moveDir.Magnitude > 0 then
        local bypassSpeed = cframeSpeed * 0.1 + math.random() * 0.05
        hrp.CFrame = hrp.CFrame + (moveDir * bypassSpeed)
    end
end)

-- Auto Play Tab
local AutoTab = Window:CreateTab("Auto Play", 4483362458)

AutoTab:CreateToggle({
    Name = "Enable Auto Play",
    CurrentValue = false,
    Callback = function(v) autoPlayEnabled = v end
})

-- Auto Play Logic (natural movement)
RunService.Heartbeat:Connect(function()
    if not autoPlayEnabled then return end

    local char = LocalPlayer.Character
    local hrp = char and char:FindFirstChild("HumanoidRootPart")
    local hum = char and char:FindFirstChildOfClass("Humanoid")
    if not hrp or not hum then return end

    local closest = nil
    local closestDist = 999

    for _, plr in ipairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
            local dist = (hrp.Position - plr.Character.HumanoidRootPart.Position).Magnitude
            if dist < closestDist then
                closestDist = dist
                closest = plr
            end
        end
    end

    if closest and closestDist <= 35 then
        local targetHRP = closest.Character.HumanoidRootPart
        local runDir = (hrp.Position - targetHRP.Position)
        if runDir.Magnitude > 0 then runDir = runDir.Unit end

        -- Obstacle avoidance
        local ray = Ray.new(hrp.Position, hrp.CFrame.LookVector * 5)
        local hit = workspace:FindPartOnRay(ray, char)
        if hit then
            local left = -hrp.CFrame.RightVector
            local right = hrp.CFrame.RightVector
            if not workspace:FindPartOnRay(Ray.new(hrp.Position, left*5), char) then
                runDir = left
            elseif not workspace:FindPartOnRay(Ray.new(hrp.Position, right*5), char) then
                runDir = right
            else
                runDir = Vector3.new(math.random(-1,1),0,math.random(-1,1)).Unit
            end
        end

        local smoothSpeed = 1.5
        hum:Move(runDir * smoothSpeed, true)
    end
end)
