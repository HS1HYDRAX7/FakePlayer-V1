-- Luna Interface Suite
local Luna = loadstring(game:HttpGet(
    "https://raw.githubusercontent.com/Nebula-Softworks/Luna-Interface-Suite/refs/heads/master/source.lua",
    true
))()

-- SERVICES
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Lighting = game:GetService("Lighting")
local LocalPlayer = Players.LocalPlayer

----------------------------------------------------------------
-- WINDOW
----------------------------------------------------------------
local Window = Luna:CreateWindow({
    Name = "Nexus Hub v1.3.9 â˜„ï¸",
    Subtitle = "Luna Edition",
    LoadingEnabled = true,
    LoadingTitle = "Nexus Hub",
    LoadingSubtitle = "Luna Interface Suite"
})

----------------------------------------------------------------
-- STATE
----------------------------------------------------------------
local playerEnabled = false
local infJumpEnabled = false
local infStaminaEnabled = false
local noclipEnabled = false

local cframeSpeed = 1
local gravity = 196.2
local currentScale = 1

local noclipConn
local staminaConn
local staminaModule
local storedEffects = {}
local originalCollisions = {}

----------------------------------------------------------------
-- UTILS
----------------------------------------------------------------
local function setCharacterScale(character, scale)
    for _,v in ipairs(character:GetDescendants()) do
        if v:IsA("NumberValue") then
            if v.Name == "BodyHeightScale"
            or v.Name == "BodyWidthScale"
            or v.Name == "BodyDepthScale"
            or v.Name == "HeadScale" then
                v.Value = scale
            end
        end
    end
end

----------------------------------------------------------------
-- PLAYER TAB
----------------------------------------------------------------
local PlayerTab = Window:CreateTab({
    Name = "Player",
    Icon = "person",
    ImageSource = "Material",
    ShowTitle = true
})

PlayerTab:CreateToggle({
    Name = "Enable Player",
    CurrentValue = false,
    Callback = function(v)
        playerEnabled = v
    end
})

PlayerTab:CreateSlider({
    Name = "CFrame Speed",
    Range = {1,170},
    Increment = 1,
    CurrentValue = 1,
    Callback = function(v)
        cframeSpeed = v
    end
})

PlayerTab:CreateSlider({
    Name = "Gravity",
    Range = {0,500},
    Increment = 1,
    CurrentValue = 196,
    Callback = function(v)
        gravity = v
        workspace.Gravity = v
    end
})

PlayerTab:CreateToggle({
    Name = "Noclip (Bypass)",
    CurrentValue = false,
    Callback = function(v)
        noclipEnabled = v
        if noclipConn then noclipConn:Disconnect() noclipConn = nil end

        local char = LocalPlayer.Character
        if not char then return end

        if v then
            originalCollisions = {}
            for _,p in ipairs(char:GetDescendants()) do
                if p:IsA("BasePart") then
                    originalCollisions[p] = p.CanCollide
                    p.CanCollide = false
                end
            end

            noclipConn = RunService.Stepped:Connect(function()
                for _,p in ipairs(char:GetDescendants()) do
                    if p:IsA("BasePart") then
                        p.CanCollide = false
                    end
                end
            end)
        else
            for p,state in pairs(originalCollisions) do
                if p and p.Parent then
                    p.CanCollide = state
                end
            end
            originalCollisions = {}
        end
    end
})

PlayerTab:CreateToggle({
    Name = "Infinite Jump",
    CurrentValue = false,
    Callback = function(v)
        infJumpEnabled = v
    end
})

----------------------------------------------------------------
-- FORSAKEN TAB
----------------------------------------------------------------
local ForsakenTab = Window:CreateTab({
    Name = "Forsaken ðŸ“‘",
    Icon = "menu_book",
    ImageSource = "Material",
    ShowTitle = true
})

ForsakenTab:CreateToggle({
    Name = "Infinite Stamina",
    CurrentValue = false,
    Callback = function(v)
        infStaminaEnabled = v
        if staminaConn then staminaConn:Disconnect() staminaConn = nil end

        if v then
            local rs = cloneref(game:GetService("ReplicatedStorage"))
            local sprint = rs:WaitForChild("Systems")
                :WaitForChild("Character")
                :WaitForChild("Game")
                :WaitForChild("Sprinting")

            staminaModule = require(sprint)
            staminaConn = RunService.Heartbeat:Connect(function()
                staminaModule.Stamina = 750
            end)
        end
    end
})

----------------------------------------------------------------
-- IN-GAME TAB
----------------------------------------------------------------
local InGameTab = Window:CreateTab({
    Name = "In-Game",
    Icon = "sports_esports",
    ImageSource = "Material",
    ShowTitle = true
})

InGameTab:CreateToggle({
    Name = "Performance Mode",
    CurrentValue = false,
    Callback = function(v)
        if v then
            storedEffects = {}
            for _,o in ipairs(workspace:GetDescendants()) do
                if o:IsA("ParticleEmitter") or o:IsA("Trail") or o:IsA("Beam") then
                    storedEffects[o] = o.Enabled
                    o.Enabled = false
                end
            end
            for _,fx in ipairs(Lighting:GetChildren()) do
                if fx:IsA("BloomEffect") or fx:IsA("BlurEffect")
                or fx:IsA("SunRaysEffect") or fx:IsA("ColorCorrectionEffect")
                or fx:IsA("DepthOfFieldEffect") then
                    storedEffects[fx] = fx.Enabled
                    fx.Enabled = false
                end
            end
        else
            for o,s in pairs(storedEffects) do
                if o and o.Parent then
                    o.Enabled = s
                end
            end
            storedEffects = {}
        end
    end
})

-- PLAYER SIZE SLIDER (FUNCIONAL)
InGameTab:CreateSlider({
    Name = "Player Size",
    Description = "0.1 = mÃ­nimo | 1 = normal | 10 = mÃ¡ximo",
    Range = {0.1,10},
    Increment = 0.1,
    CurrentValue = 1,
    Callback = function(v)
        currentScale = v
        local char = LocalPlayer.Character
        if char then
            setCharacterScale(char, currentScale)
        end
    end
})

----------------------------------------------------------------
-- INFORMATION TAB
----------------------------------------------------------------
local InfoTab = Window:CreateTab({
    Name = "Information ðŸ’¾",
    Icon = "info",
    ImageSource = "Material",
    ShowTitle = true
})

local clock = InfoTab:CreateParagraph({
    Title = "Clock",
    Text = "--:--:--"
})

task.spawn(function()
    while task.wait(1) do
        local t = os.date("*t")
        clock:Set({
            Title = "Clock",
            Text = string.format("%02d:%02d:%02d", t.hour, t.min, t.sec)
        })
    end
end)

InfoTab:CreateParagraph({
    Title = "Creators",
    Text = "Hydra\nNexus Hub Team"
})

InfoTab:CreateParagraph({
    Title = "Changelog",
    Text = "- Player Size via BodyScales\n- Luna UI\n- Stability fixes"
})

----------------------------------------------------------------
-- EVENTS
----------------------------------------------------------------
UserInputService.JumpRequest:Connect(function()
    if infJumpEnabled then
        local hum = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
        if hum then
            hum:ChangeState(Enum.HumanoidStateType.Jumping)
        end
    end
end)

RunService.Heartbeat:Connect(function()
    if not playerEnabled then return end

    local char = LocalPlayer.Character
    local hrp = char and char:FindFirstChild("HumanoidRootPart")
    local hum = char and char:FindFirstChildOfClass("Humanoid")
    if not hrp or not hum then return end

    workspace.Gravity = gravity
    local dir = hum.MoveDirection
    if dir.Magnitude > 0 then
        hrp.CFrame = hrp.CFrame + (dir * (cframeSpeed * 0.08))
    end
end)

LocalPlayer.CharacterAdded:Connect(function(char)
    task.wait(0.5)
    setCharacterScale(char, currentScale)
end)
