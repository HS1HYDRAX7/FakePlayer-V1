--====================================================
-- Nexus Hub v2.0.6 â˜„ï¸
--====================================================

local Luna = loadstring(game:HttpGet(
	"https://raw.githubusercontent.com/Nebula-Softworks/Luna-Interface-Suite/main/source.lua"
))()

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Lighting = game:GetService("Lighting")
local LocalPlayer = Players.LocalPlayer

--====================================================
-- WINDOW
--====================================================

local Window = Luna:CreateWindow({
	Name = "Nexus Hub v2.0.6 â˜„ï¸",
	Subtitle = "by Hydra",
	LoadingEnabled = true,
	LoadingTitle = "Nexus Hub V2 â˜„ï¸",
	LoadingSubtitle = "Loading systems...",
	ConfigSettings = {
		RootFolder = nil,
		ConfigFolder = "NexusHub"
	}
})

--====================================================
-- PLAYER TAB
--====================================================

local PlayerTab = Window:CreateTab({
	Name = "Player",
	Icon = "person",
	ImageSource = "Material",
	ShowTitle = true
})

local playerEnabled = false
local noclipEnabled = false
local infJump = false
local cframeSpeed = 1
local gravity = 196.2
local noclipConn
local originalCollisions = {}

local function applyNoclip(character)
	if noclipConn then noclipConn:Disconnect() end
	if not character then return end

	originalCollisions = {}
	for _, part in ipairs(character:GetDescendants()) do
		if part:IsA("BasePart") then
			originalCollisions[part] = part.CanCollide
			part.CanCollide = false
		end
	end

	noclipConn = RunService.Stepped:Connect(function()
		if not noclipEnabled then return end
		for _, part in ipairs(character:GetDescendants()) do
			if part:IsA("BasePart") then
				part.CanCollide = false
			end
		end
	end)
end

local function removeNoclip()
	if noclipConn then noclipConn:Disconnect() noclipConn = nil end
	for part, state in pairs(originalCollisions) do
		if part and part.Parent then
			part.CanCollide = state
		end
	end
	originalCollisions = {}
end

LocalPlayer.CharacterAdded:Connect(function(char)
	if noclipEnabled then
		task.wait(0.2)
		applyNoclip(char)
	end
end)

PlayerTab:CreateToggle({
	Name = "Enable",
	CurrentValue = false,
	Callback = function(v)
		playerEnabled = v
	end
})

PlayerTab:CreateSlider({
	Name = "CFrame Speed",
	Range = {1,70},
	Increment = 1,
	CurrentValue = 1,
	Callback = function(v)
		cframeSpeed = v
	end
})

PlayerTab:CreateSlider({
	Name = "Gravity",
	Range = {0,300},
	Increment = 1,
	CurrentValue = 196,
	Callback = function(v)
		gravity = v
	end
})

PlayerTab:CreateToggle({
	Name = "Noclip",
	CurrentValue = false,
	Callback = function(v)
		noclipEnabled = v
		if v then
			applyNoclip(LocalPlayer.Character)
		else
			removeNoclip()
		end
	end
})

PlayerTab:CreateToggle({
	Name = "Infinite Jump",
	CurrentValue = false,
	Callback = function(v)
		infJump = v
	end
})

UserInputService.JumpRequest:Connect(function()
	if infJump and LocalPlayer.Character then
		local hum = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
		if hum then
			hum:ChangeState(Enum.HumanoidStateType.Jumping)
		end
	end
end)

RunService.Heartbeat:Connect(function()
	if not playerEnabled then return end
	local char = LocalPlayer.Character
	local hrp = char and char:FindFirstChild("HumanoidRootPart")
	local hum = char and char:FindFirstChildOfClass("Humanoid")
	if not hrp or not hum then return end

	workspace.Gravity = gravity
	local dir = hum.MoveDirection
	if dir.Magnitude > 0 then
		hrp.CFrame = hrp.CFrame + (dir * (cframeSpeed * 0.08))
	end
end)

--====================================================
-- FORSAKEN TAB
--====================================================

local ForsakenTab = Window:CreateTab({
	Name = "Forsaken ðŸ“‘",
	Icon = "description",
	ImageSource = "Material",
	ShowTitle = true
})

local espSurvivor = false
local espKiller = false
local espGen = false
local autoGen = false
local genDelay = 5
local genBusy = false
local infStamina = false
local staminaConn
local staminaModule

local ESPFolder = Instance.new("Folder", workspace)
ESPFolder.Name = "NexusESP_" .. LocalPlayer.UserId

local function clearESP()
	for _, v in ipairs(ESPFolder:GetChildren()) do
		v:Destroy()
	end
end

local function addHighlight(model, color)
	if not model or model:FindFirstChild("NexusHL") then return end
	local hl = Instance.new("Highlight")
	hl.Name = "NexusHL"
	hl.Adornee = model
	hl.FillColor = color
	hl.OutlineColor = color
	hl.FillTransparency = 0.5
	hl.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
	hl.Parent = model
end

local function createNameESP(character, text, color)
	if not character or character:FindFirstChild("NexusName") then return end
	local hrp = character:FindFirstChild("HumanoidRootPart")
	if not hrp then return end

	local bb = Instance.new("BillboardGui")
	bb.Name = "NexusName"
	bb.Adornee = hrp
	bb.Size = UDim2.fromOffset(100, 20)
	bb.StudsOffset = Vector3.new(0, -3, 0)
	bb.AlwaysOnTop = true
	bb.Parent = character

	local lbl = Instance.new("TextLabel")
	lbl.Size = UDim2.fromScale(1,1)
	lbl.BackgroundTransparency = 1
	lbl.Text = text
	lbl.TextColor3 = color
	lbl.TextSize = 12
	lbl.FontFace = Font.new("rbxassetid://12187370928")
	lbl.TextStrokeTransparency = 0.3
	lbl.Parent = bb
end

local function updatePlayerESP()
	clearESP()

	local wp = workspace:FindFirstChild("Players")
	if not wp then return end

	local killers = wp:FindFirstChild("Killers")
	local survivors = wp:FindFirstChild("Survivors")

	for _, pl in ipairs(Players:GetPlayers()) do
		if pl ~= LocalPlayer and pl.Character then
			if espKiller and killers and pl.Character.Parent == killers then
				addHighlight(pl.Character, Color3.fromRGB(255,0,0))
				createNameESP(pl.Character, pl.Name, Color3.fromRGB(255,80,80))
			end
			if espSurvivor and survivors and pl.Character.Parent == survivors then
				addHighlight(pl.Character, Color3.fromRGB(0,255,0))
				createNameESP(pl.Character, pl.Name, Color3.fromRGB(80,255,80))
			end
		end
	end
end

local function createGenESP(gen)
	if gen:FindFirstChild("NexusGen") then return end

	local bb = Instance.new("BillboardGui")
	bb.Name = "NexusGen"
	bb.Adornee = gen
	bb.Size = UDim2.fromOffset(80, 20)
	bb.StudsOffset = Vector3.new(0, 4, 0)
	bb.AlwaysOnTop = true
	bb.Parent = gen

	local lbl = Instance.new("TextLabel")
	lbl.Size = UDim2.fromScale(1,1)
	lbl.BackgroundTransparency = 1
	lbl.TextColor3 = Color3.fromRGB(255,255,0)
	lbl.TextSize = 12
	lbl.FontFace = Font.new("rbxassetid://12187370928")
	lbl.TextStrokeTransparency = 0.3
	lbl.Parent = bb

	RunService.Heartbeat:Connect(function()
		if not gen or not gen.Parent then return end
		local prog =
			gen:FindFirstChild("Progress")
			or gen:FindFirstChild("Percent")
			or gen:FindFirstChild("Completion")

		if prog and prog:IsA("NumberValue") then
			lbl.Text = math.floor(prog.Value) .. "%"
		else
			lbl.Text = "GEN"
		end
	end)
end

local function updateGenESP()
	local map = workspace:FindFirstChild("Map")
	local ing = map and map:FindFirstChild("Ingame")
	local m = ing and ing:FindFirstChild("Map")
	if not m then return end

	for _, g in ipairs(m:GetChildren()) do
		if g.Name == "Generator" and espGen then
			addHighlight(g, Color3.fromRGB(255,255,0))
			createGenESP(g)
		end
	end
end

ForsakenTab:CreateToggle({
	Name = "ESP Survivors",
	CurrentValue = false,
	Callback = function(v)
		espSurvivor = v
		updatePlayerESP()
	end
})

ForsakenTab:CreateToggle({
	Name = "ESP Killers",
	CurrentValue = false,
	Callback = function(v)
		espKiller = v
		updatePlayerESP()
	end
})

ForsakenTab:CreateToggle({
	Name = "ESP Generators",
	CurrentValue = false,
	Callback = function(v)
		espGen = v
		clearESP()
		updateGenESP()
	end
})

ForsakenTab:CreateToggle({
	Name = "Auto Generator",
	CurrentValue = false,
	Callback = function(v)
		autoGen = v
	end
})

ForsakenTab:CreateSlider({
	Name = "Auto Gen Speed",
	Range = {1,10},
	Increment = 1,
	CurrentValue = 5,
	Callback = function(v)
		genDelay = v
	end
})

ForsakenTab:CreateToggle({
	Name = "Infinite Stamina",
	CurrentValue = false,
	Callback = function(v)
		infStamina = v
		if staminaConn then staminaConn:Disconnect() staminaConn = nil end
		if v then
			local rs = cloneref(game:GetService("ReplicatedStorage"))
			local sprint = rs:WaitForChild("Systems")
				:WaitForChild("Character")
				:WaitForChild("Game")
				:WaitForChild("Sprinting")
			staminaModule = require(sprint)
			staminaConn = RunService.Heartbeat:Connect(function()
				if infStamina then
					staminaModule.Stamina = 999
				end
			end)
		end
	end
})

RunService.Heartbeat:Connect(function()
	if not autoGen or genBusy then return end
	genBusy = true

	local map = workspace:FindFirstChild("Map")
	local ing = map and map:FindFirstChild("Ingame")
	local m = ing and ing:FindFirstChild("Map")

	if m then
		for _, g in ipairs(m:GetChildren()) do
			if g.Name == "Generator" and g:FindFirstChild("Remotes") then
				pcall(function()
					g.Remotes.RE:FireServer()
				end)
				task.wait(genDelay)
			end
		end
	end

	genBusy = false
end)

--====================================================
-- OTHERS TAB
--====================================================

local OthersTab = Window:CreateTab({
	Name = "Others âœ¨",
	Icon = "sports_esports",
	ImageSource = "Material",
	ShowTitle = true
})

local stored = {}

OthersTab:CreateToggle({
	Name = "Performance Mode",
	CurrentValue = false,
	Callback = function(v)
		if v then
			stored = {}
			for _, o in ipairs(workspace:GetDescendants()) do
				if o:IsA("ParticleEmitter") or o:IsA("Trail") or o:IsA("Beam") then
					stored[o] = o.Enabled
					o.Enabled = false
				end
			end
			for _, fx in ipairs(Lighting:GetChildren()) do
				if fx:IsA("BloomEffect")
				or fx:IsA("BlurEffect")
				or fx:IsA("SunRaysEffect")
				or fx:IsA("ColorCorrectionEffect")
				or fx:IsA("DepthOfFieldEffect") then
					stored[fx] = fx.Enabled
					fx.Enabled = false
				end
			end
		else
			for o, s in pairs(stored) do
				if o and o.Parent then
					o.Enabled = s
				end
			end
			stored = {}
		end
	end
})

--====================================================
-- INFORMATION TAB
--====================================================

local InfoTab = Window:CreateTab({
	Name = "Information",
	Icon = "info",
	ImageSource = "Material",
	ShowTitle = true
})

local clock = InfoTab:CreateLabel({
	Text = "Clock: --:--:--",
	Style = 1
})

task.spawn(function()
	while task.wait(1) do
		clock:Set("Clock: " .. os.date("%H:%M:%S"))
	end
end)

InfoTab:CreateParagraph({
	Title = "Creators",
	Text = "Hydra (Owner)\nLincoln"
})

InfoTab:CreateParagraph({
	Title = "Changelog",
	Text = "- Highlight ESP\n- Name ESP\n- Generator %\n- Auto Generator Control\n- Stability"
})
