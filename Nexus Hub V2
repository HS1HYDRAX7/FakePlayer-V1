local Luna = loadstring(game:HttpGet(
    "https://raw.githubusercontent.com/Nebula-Softworks/Luna-Interface-Suite/main/source.lua"
))()

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Lighting = game:GetService("Lighting")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local LocalPlayer = Players.LocalPlayer
local FONT = Font.new("rbxassetid://12187370928")

local Window = Luna:CreateWindow({
	Name = "Nexus Hub v2.1.0 â˜„ï¸",
	Subtitle = "by Hydra",
	LoadingEnabled = true,
	LoadingTitle = "Nexus Hub V2 â˜„ï¸",
	LoadingSubtitle = "Loading systems...",
	ConfigSettings = { RootFolder = nil, ConfigFolder = "NexusHub" }
})

local PlayerTab = Window:CreateTab({ Name="Player", Icon="person", ImageSource="Material", ShowTitle=true })
local ForsakenTab = Window:CreateTab({ Name="Forsaken ðŸ“‘", Icon="description", ImageSource="Material", ShowTitle=true })
local OthersTab = Window:CreateTab({ Name="Others âœ¨", Icon="sports_esports", ImageSource="Material", ShowTitle=true })
local InfoTab = Window:CreateTab({ Name="Information", Icon="info", ImageSource="Material", ShowTitle=true })

-- PLAYER
local playerEnabled=false
local noclipEnabled=false
local infJump=false
local cframeSpeed=1
local gravity=196.2
local noclipConn
local originalCollisions={}

local function applyNoclip(character)
	if noclipConn then noclipConn:Disconnect() end
	if not character then return end
	originalCollisions={}
	for _,p in ipairs(character:GetDescendants()) do
		if p:IsA("BasePart") then
			originalCollisions[p]=p.CanCollide
			p.CanCollide=false
		end
	end
	noclipConn=RunService.Stepped:Connect(function()
		if not noclipEnabled then return end
		if not character.Parent then return end
		for _,p in ipairs(character:GetDescendants()) do
			if p:IsA("BasePart") then p.CanCollide=false end
		end
	end)
end

local function removeNoclip()
	if noclipConn then noclipConn:Disconnect() noclipConn=nil end
	for p,v in pairs(originalCollisions) do
		if p and p.Parent then p.CanCollide=v end
	end
	originalCollisions={}
end

LocalPlayer.CharacterAdded:Connect(function(c)
	if noclipEnabled then task.wait(0.2) applyNoclip(c) end
end)

PlayerTab:CreateToggle({ Name="Enable", CurrentValue=false, Callback=function(v) playerEnabled=v end })
PlayerTab:CreateSlider({ Name="CFrame Speed", Range={1,70}, Increment=1, CurrentValue=1, Callback=function(v) cframeSpeed=v end })
PlayerTab:CreateSlider({ Name="Gravity", Range={0,300}, Increment=1, CurrentValue=196, Callback=function(v) gravity=v end })
PlayerTab:CreateToggle({
	Name="Noclip", CurrentValue=false,
	Callback=function(v)
		noclipEnabled=v
		if v then applyNoclip(LocalPlayer.Character) else removeNoclip() end
	end
})
PlayerTab:CreateToggle({ Name="Infinite Jump", CurrentValue=false, Callback=function(v) infJump=v end })

UserInputService.JumpRequest:Connect(function()
	if infJump and LocalPlayer.Character then
		local hum=LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
		if hum then hum:ChangeState(Enum.HumanoidStateType.Jumping) end
	end
end)

RunService.Heartbeat:Connect(function()
	if not playerEnabled then return end
	local char=LocalPlayer.Character
	local hrp=char and char:FindFirstChild("HumanoidRootPart")
	local hum=char and char:FindFirstChildOfClass("Humanoid")
	if not hrp or not hum then return end
	workspace.Gravity=gravity
	local dir=hum.MoveDirection
	if dir.Magnitude>0 then
		hrp.CFrame=hrp.CFrame+(dir*(cframeSpeed*0.08))
	end
end)

-- FORSAKEN
local espSurvivor=false
local espKiller=false
local espGen=false
local autoGen=false
local genDelay=5
local genBusy=false

local infStamina=false
local staminaConn
local staminaModule

local function addHighlight(inst,color)
	local hl=inst:FindFirstChild("NexusHL")
	if not hl then
		hl=Instance.new("Highlight")
		hl.Name="NexusHL"
		hl.Adornee=inst
		hl.DepthMode=Enum.HighlightDepthMode.AlwaysOnTop
		hl.Parent=inst
	end
	hl.FillColor=color
	hl.OutlineColor=color
	hl.FillTransparency=0.45
end

local function addNameESP(char,text,color)
	if char:FindFirstChild("NexusName") then return end
	local hrp=char:FindFirstChild("HumanoidRootPart")
	if not hrp then return end
	local bb=Instance.new("BillboardGui")
	bb.Name="NexusName"
	bb.Adornee=hrp
	bb.Size=UDim2.fromOffset(120,16)
	bb.StudsOffset=Vector3.new(0,-3,0)
	bb.AlwaysOnTop=true
	bb.Parent=char
	local tl=Instance.new("TextLabel")
	tl.Size=UDim2.fromScale(1,1)
	tl.BackgroundTransparency=1
	tl.Text=text
	tl.FontFace=FONT
	tl.TextSize=11
	tl.TextColor3=color
	tl.TextStrokeTransparency=0.3
	tl.Parent=bb
end

local function clearCharESP(char)
	if char:FindFirstChild("NexusHL") then char.NexusHL:Destroy() end
	if char:FindFirstChild("NexusName") then char.NexusName:Destroy() end
end

local function updatePlayerESP()
	local wp=workspace:FindFirstChild("Players")
	if not wp then return end
	local killers=wp:FindFirstChild("Killers")
	local survivors=wp:FindFirstChild("Survivors")

	for _,plr in ipairs(Players:GetPlayers()) do
		if plr~=LocalPlayer and plr.Character then
			if killers and plr.Character.Parent==killers then
				if espKiller then
					addHighlight(plr.Character,Color3.fromRGB(255,0,0))
					addNameESP(plr.Character,plr.Name,Color3.fromRGB(255,80,80))
				else
					clearCharESP(plr.Character)
				end
			end
			if survivors and plr.Character.Parent==survivors then
				if espSurvivor then
					addHighlight(plr.Character,Color3.fromRGB(0,255,0))
					addNameESP(plr.Character,plr.Name,Color3.fromRGB(80,255,80))
				else
					clearCharESP(plr.Character)
				end
			end
		end
	end
end

local DARK_GREEN=Color3.fromRGB(0,120,0)
local YELLOW=Color3.fromRGB(255,255,0)

local function normalizeProgress(v)
	if v>=10000 then return math.clamp(math.floor(v/100),0,100) end
	if v>100 then return math.clamp(math.floor(v),0,100) end
	return math.clamp(math.floor(v),0,100)
end

local function updateGenESP()
	local map=workspace:FindFirstChild("Map")
	local ing=map and map:FindFirstChild("Ingame")
	local m=ing and ing:FindFirstChild("Map")
	if not m then return end

	for _,g in ipairs(m:GetChildren()) do
		if g.Name=="Generator" then
			if espGen then
				local prog=g:FindFirstChild("Progress")
				local percent=prog and normalizeProgress(prog.Value) or 0
				local completed=percent>=100

				addHighlight(g,completed and DARK_GREEN or YELLOW)

				if not g:FindFirstChild("NexusGen") then
					local bb=Instance.new("BillboardGui")
					bb.Name="NexusGen"
					bb.Adornee=g
					bb.Size=UDim2.fromOffset(150,18)
					bb.StudsOffset=Vector3.new(0,3,0)
					bb.AlwaysOnTop=true
					bb.Parent=g
					local tl=Instance.new("TextLabel")
					tl.Size=UDim2.fromScale(1,1)
					tl.BackgroundTransparency=1
					tl.FontFace=FONT
					tl.TextStrokeTransparency=0.3
					tl.Parent=bb
				end

				local tl=g.NexusGen.TextLabel
				if completed then
					tl.Text="Generator repaired"
					tl.TextSize=9
					tl.TextColor3=DARK_GREEN
				else
					tl.Text=percent.."%"
					tl.TextSize=11
					tl.TextColor3=YELLOW
				end
			else
				if g:FindFirstChild("NexusHL") then g.NexusHL:Destroy() end
				if g:FindFirstChild("NexusGen") then g.NexusGen:Destroy() end
			end
		end
	end
end

ForsakenTab:CreateToggle({ Name="ESP Survivors", CurrentValue=false, Callback=function(v) espSurvivor=v end })
ForsakenTab:CreateToggle({ Name="ESP Killers", CurrentValue=false, Callback=function(v) espKiller=v end })
ForsakenTab:CreateToggle({ Name="ESP Generators", CurrentValue=false, Callback=function(v) espGen=v end })

ForsakenTab:CreateToggle({
	Name="Infinite Stamina", CurrentValue=false,
	Callback=function(v)
		infStamina=v
		if staminaConn then staminaConn:Disconnect() staminaConn=nil end
		if v then
			local sprint=ReplicatedStorage:WaitForChild("Systems"):WaitForChild("Character"):WaitForChild("Game"):WaitForChild("Sprinting")
			staminaModule=require(sprint)
			staminaConn=RunService.Heartbeat:Connect(function()
				if infStamina and staminaModule then
					staminaModule.Stamina=staminaModule.MaxStamina or 999
				end
			end)
		end
	end
})

ForsakenTab:CreateToggle({ Name="Auto Generator", CurrentValue=false, Callback=function(v) autoGen=v end })
ForsakenTab:CreateSlider({ Name="Auto Gen Speed", Range={1,10}, Increment=1, CurrentValue=5, Callback=function(v) genDelay=v end })

RunService.Heartbeat:Connect(function()
	updatePlayerESP()
	updateGenESP()

	if not autoGen or genBusy then return end
	genBusy=true
	local map=workspace:FindFirstChild("Map")
	local ing=map and map:FindFirstChild("Ingame")
	local m=ing and ing:FindFirstChild("Map")
	if m then
		for _,g in ipairs(m:GetChildren()) do
			if g.Name=="Generator" and g:FindFirstChild("Remotes") then
				pcall(function() g.Remotes.RE:FireServer() end)
				task.wait(genDelay)
			end
		end
	end
	genBusy=false
end)

OthersTab:CreateToggle({
	Name="Performance Mode", CurrentValue=false,
	Callback=function(v)
		if v then
			for _,o in ipairs(workspace:GetDescendants()) do
				if o:IsA("ParticleEmitter") or o:IsA("Trail") or o:IsA("Beam") then o.Enabled=false end
			end
			for _,fx in ipairs(Lighting:GetChildren()) do
				if fx:IsA("BloomEffect") or fx:IsA("BlurEffect") or fx:IsA("SunRaysEffect")
				or fx:IsA("ColorCorrectionEffect") or fx:IsA("DepthOfFieldEffect") then
					fx.Enabled=false
				end
			end
		end
	end
})

-- CHAT MESSAGE ON KILL
local function onKill(victim, killer)
	if killer and killer.Name == "HSHSHYDRA" then
		pcall(function()
			game:GetService("ReplicatedStorage").DefaultChatSystemChatEvents.SayMessageRequest:FireServer(
				"Hahahaha You've been OBLITERATED",
				"All"
			)
		end)
	end
end

-- Substitua "KillEvent" pelo RemoteEvent correto do jogo
local killEvent = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("Kill")
killEvent.OnClientEvent:Connect(onKill)

-- CLOCK
local clockLabel=InfoTab:CreateLabel({ Text="Clock: --:--:--", Style=1 })
task.spawn(function()
	while task.wait(1) do clockLabel:Set("Clock: "..os.date("%H:%M:%S")) end
end)

local creditText=InfoTab:CreateParagraph({ Title="Creators", Text="Hydra (Owner)" })
local hue=0
RunService.RenderStepped:Connect(function()
	hue=(hue+1)%360
	local c=Color3.fromHSV(hue/360,1,1)
	if creditText.TextLabel then creditText.TextLabel.TextColor3=c end
end)
