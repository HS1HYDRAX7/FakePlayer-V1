-- LUNA UI
local Luna = loadstring(game:HttpGet(
    "https://raw.githubusercontent.com/Nebula-Softworks/Luna-Interface-Suite/main/source.lua"
))()

local Window = Luna:CreateWindow({
    Name = "Nexus Hub v1.3.9 â˜„ï¸",
    Subtitle = "by Hydra",
    LoadingEnabled = true,
    ConfigSettings = {
        RootFolder = nil,
        ConfigFolder = "NexusHub"
    }
})

-- SERVICES
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Lighting = game:GetService("Lighting")
local TextChatService = game:GetService("TextChatService")
local LocalPlayer = Players.LocalPlayer

-- STATES
local playerEnabled = false
local infJumpEnabled = false
local infStaminaEnabled = false
local chatAssistantEnabled = false

local cframeSpeed = 1
local gravity = 196.2

local storedEffects = {}
local staminaConn
local staminaModule

----------------------------------------------------------------
-- PLAYER TAB
----------------------------------------------------------------
local PlayerTab = Window:CreateTab({
    Name = "Player",
    Icon = "person",
    ImageSource = "Material",
    ShowTitle = true
})

PlayerTab:CreateToggle({
    Name = "Enable Player",
    CurrentValue = false,
    Callback = function(v)
        playerEnabled = v
    end
})

PlayerTab:CreateSlider({
    Name = "CFrame Speed",
    Range = {1,170},
    Increment = 1,
    CurrentValue = 1,
    Callback = function(v)
        cframeSpeed = v
    end
})

PlayerTab:CreateSlider({
    Name = "Gravity",
    Range = {0,500},
    Increment = 1,
    CurrentValue = 196,
    Callback = function(v)
        gravity = v
        if playerEnabled then
            workspace.Gravity = v
        end
    end
})

PlayerTab:CreateToggle({
    Name = "Inf Jump",
    CurrentValue = false,
    Callback = function(v)
        infJumpEnabled = v
    end
})

----------------------------------------------------------------
-- FORSAKEN TAB
----------------------------------------------------------------
local ForsakenTab = Window:CreateTab({
    Name = "Forsaken ðŸ“‘",
    Icon = "description",
    ImageSource = "Material",
    ShowTitle = true
})

ForsakenTab:CreateToggle({
    Name = "Inf Stamina",
    CurrentValue = false,
    Callback = function(v)
        infStaminaEnabled = v

        if staminaConn then
            staminaConn:Disconnect()
            staminaConn = nil
        end

        if v then
            local rs = cloneref(game:GetService("ReplicatedStorage"))
            local sprint = rs:WaitForChild("Systems")
                :WaitForChild("Character")
                :WaitForChild("Game")
                :WaitForChild("Sprinting")

            staminaModule = require(sprint)

            staminaConn = RunService.Heartbeat:Connect(function()
                if infStaminaEnabled then
                    staminaModule.Stamina = 750
                end
            end)
        end
    end
})

----------------------------------------------------------------
-- IN-GAME TAB (CHAT ASSISTANT AQUI)
----------------------------------------------------------------
local InGameTab = Window:CreateTab({
    Name = "In-game",
    Icon = "sports_esports",
    ImageSource = "Material",
    ShowTitle = true
})

----------------------------------------------------------------
-- CHAT ASSISTANT (SAFE REPHRASE)
----------------------------------------------------------------

-- DicionÃ¡rio base (expansÃ­vel)
local Synonyms = {
    ["bug"] = "problema",
    ["bugou"] = "apresentou um problema",
    ["bugado"] = "com problema",
    ["quebrou"] = "parou de funcionar",
    ["crashou"] = "fechou inesperadamente",
    ["hack"] = "ferramenta",
    ["exploit"] = "recurso",
    ["lag"] = "atraso",
    ["lagado"] = "com atraso"
}

-- ReformulaÃ§Ã£o geral (qualquer frase)
local function RephraseMessage(msg)
    msg = msg:lower()

    for word, replacement in pairs(Synonyms) do
        msg = msg:gsub("%f[%a]" .. word .. "%f[%A]", replacement)
    end

    -- suavizaÃ§Ã£o geral (nÃ£o burla filtro)
    msg = msg:gsub("!", "")
    msg = msg:gsub("%s+", " ")
    msg = msg .. "."

    return msg
end

-- Hook seguro
local originalSend
local hookedChannel

local function EnableChatAssistant()
    if TextChatService.ChatVersion ~= Enum.ChatVersion.TextChatService then
        return
    end

    local channel = TextChatService.TextChannels.RBXGeneral
    if not channel then return end

    hookedChannel = channel
    originalSend = channel.SendAsync

    channel.SendAsync = function(self, message)
        if chatAssistantEnabled then
            message = RephraseMessage(message)
        end
        return originalSend(self, message)
    end
end

local function DisableChatAssistant()
    if hookedChannel and originalSend then
        hookedChannel.SendAsync = originalSend
    end
    hookedChannel = nil
    originalSend = nil
end

-- TOGGLE NA UI
InGameTab:CreateToggle({
    Name = "Chat Assistant (Safe Rephrase)",
    CurrentValue = false,
    Callback = function(v)
        chatAssistantEnabled = v
        if v then
            EnableChatAssistant()
        else
            DisableChatAssistant()
        end
    end
})

----------------------------------------------------------------
-- PERFORMANCE MODE
----------------------------------------------------------------
InGameTab:CreateToggle({
    Name = "Performance Mode",
    CurrentValue = false,
    Callback = function(v)
        if v then
            storedEffects = {}

            for _,o in ipairs(workspace:GetDescendants()) do
                if o:IsA("ParticleEmitter") or o:IsA("Trail") or o:IsA("Beam") then
                    storedEffects[o] = o.Enabled
                    o.Enabled = false
                end
            end

            for _,fx in ipairs(Lighting:GetChildren()) do
                if fx:IsA("BloomEffect")
                or fx:IsA("BlurEffect")
                or fx:IsA("SunRaysEffect")
                or fx:IsA("ColorCorrectionEffect")
                or fx:IsA("DepthOfFieldEffect") then
                    storedEffects[fx] = fx.Enabled
                    fx.Enabled = false
                end
            end
        else
            for o,s in pairs(storedEffects) do
                if o and o.Parent then
                    o.Enabled = s
                end
            end
            storedEffects = {}
        end
    end
})

----------------------------------------------------------------
-- INFORMATION TAB
----------------------------------------------------------------
local InfoTab = Window:CreateTab({
    Name = "Information ðŸ’¾",
    Icon = "info",
    ImageSource = "Material",
    ShowTitle = true
})

local clockLabel = InfoTab:CreateLabel({
    Text = "Clock: --:--:--",
    Style = 1
})

task.spawn(function()
    while task.wait(1) do
        clockLabel:Set("Clock: " .. os.date("%H:%M:%S"))
    end
end)

InfoTab:CreateParagraph({
    Title = "Creators",
    Text = "Hydra\nNexus Hub Team"
})

InfoTab:CreateParagraph({
    Title = "Changelog",
    Text = "- Stability\n- Chat Assistant\n- Forsaken Support"
})

----------------------------------------------------------------
-- INF JUMP
----------------------------------------------------------------
UserInputService.JumpRequest:Connect(function()
    if infJumpEnabled and LocalPlayer.Character then
        local hum = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
        if hum then
            hum:ChangeState(Enum.HumanoidStateType.Jumping)
        end
    end
end)

----------------------------------------------------------------
-- MOVEMENT LOOP
----------------------------------------------------------------
RunService.Heartbeat:Connect(function()
    if not playerEnabled then return end

    local char = LocalPlayer.Character
    local hrp = char and char:FindFirstChild("HumanoidRootPart")
    local hum = char and char:FindFirstChildOfClass("Humanoid")

    if not hrp or not hum then return end

    workspace.Gravity = gravity

    local dir = hum.MoveDirection
    if dir.Magnitude > 0 then
        hrp.CFrame = hrp.CFrame + (dir * (cframeSpeed * 0.08))
    end
end)
