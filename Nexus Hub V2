local Luna = loadstring(game:HttpGet(
    "https://raw.githubusercontent.com/Nebula-Softworks/Luna-Interface-Suite/refs/heads/master/source.lua",
    true
))()

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Lighting = game:GetService("Lighting")

local LocalPlayer = Players.LocalPlayer

local playerEnabled = false
local noclipEnabled = false
local infJumpEnabled = false
local infStaminaEnabled = false

local cframeSpeed = 1
local gravity = 196.2

local staminaConn
local staminaModule
local noclipConn
local originalCollisions = {}
local storedEffects = {}

local function applyNoclip(character)
    if noclipConn then
        noclipConn:Disconnect()
        noclipConn = nil
    end

    if not noclipEnabled or not character then return end

    originalCollisions = {}
    for _, p in ipairs(character:GetDescendants()) do
        if p:IsA("BasePart") then
            originalCollisions[p] = p.CanCollide
            p.CanCollide = false
        end
    end

    noclipConn = RunService.Stepped:Connect(function()
        if not noclipEnabled then return end
        if not character or not character.Parent then return end

        for _, p in ipairs(character:GetDescendants()) do
            if p:IsA("BasePart") then
                p.CanCollide = false
            end
        end
    end)
end

local function restoreCollisions()
    if noclipConn then
        noclipConn:Disconnect()
        noclipConn = nil
    end

    for p, state in pairs(originalCollisions) do
        if p and p.Parent then
            p.CanCollide = state
        end
    end

    originalCollisions = {}
end

LocalPlayer.CharacterAdded:Connect(function(char)
    task.wait(0.2)
    if noclipEnabled then
        applyNoclip(char)
    end
end)

local Window = Luna:CreateWindow({
    Name = "Nexus Hub v2.0.3 ☄️",
    Subtitle = "by Hydra",
    LoadingEnabled = true,
    LoadingTitle = "Nexus Hub V2 ☄️",
    LoadingSubtitle = "Loading systems...",
    ConfigSettings = {
        RootFolder = nil,
        ConfigFolder = "NexusHub"
    }
})

Window:CreateHomeTab({
    SupportedExecutors = {"Krnl","Fluxus","Synapse X","Electron","Delta","Codex"},
    DiscordInvite = "8fZJn5pRXw",
    Icon = 1
})

local PlayerTab = Window:CreateTab({
    Name = "Player",
    Icon = "person",
    ImageSource = "Material",
    ShowTitle = true
})

PlayerTab:CreateToggle({
    Name = "Enable Player",
    CurrentValue = false,
    Callback = function(v)
        playerEnabled = v
    end
})

PlayerTab:CreateSlider({
    Name = "CFrame Speed",
    Range = {1,170},
    Increment = 1,
    CurrentValue = 1,
    Callback = function(v)
        cframeSpeed = v
    end
})

PlayerTab:CreateSlider({
    Name = "Gravity",
    Range = {0,500},
    Increment = 1,
    CurrentValue = 196,
    Callback = function(v)
        gravity = v
        if playerEnabled then
            workspace.Gravity = v
        end
    end
})

PlayerTab:CreateToggle({
    Name = "Noclip (Persistent)",
    CurrentValue = false,
    Callback = function(v)
        noclipEnabled = v
        if v then
            applyNoclip(LocalPlayer.Character)
        else
            restoreCollisions()
        end
    end
})

PlayerTab:CreateToggle({
    Name = "Infinite Jump",
    CurrentValue = false,
    Callback = function(v)
        infJumpEnabled = v
    end
})

local ForsakenTab = Window:CreateTab({
    Name = "Forsaken",
    Icon = "bolt",
    ImageSource = "Material",
    ShowTitle = true
})

ForsakenTab:CreateToggle({
    Name = "Infinite Stamina",
    CurrentValue = false,
    Callback = function(v)
        infStaminaEnabled = v

        if staminaConn then
            staminaConn:Disconnect()
            staminaConn = nil
        end

        if v then
            local rs = cloneref(game:GetService("ReplicatedStorage"))
            local sprint = rs:WaitForChild("Systems")
                :WaitForChild("Character")
                :WaitForChild("Game")
                :WaitForChild("Sprinting")

            staminaModule = require(sprint)

            staminaConn = RunService.Heartbeat:Connect(function()
                if infStaminaEnabled then
                    staminaModule.Stamina = 750
                end
            end)
        end
    end
})

local InGameTab = Window:CreateTab({
    Name = "In-game",
    Icon = "tune",
    ImageSource = "Material",
    ShowTitle = true
})

InGameTab:CreateToggle({
    Name = "Performance Mode",
    CurrentValue = false,
    Callback = function(v)
        if v then
            storedEffects = {}

            for _, o in ipairs(workspace:GetDescendants()) do
                if o:IsA("ParticleEmitter") or o:IsA("Trail") or o:IsA("Beam") then
                    storedEffects[o] = o.Enabled
                    o.Enabled = false
                end
            end

            for _, fx in ipairs(Lighting:GetChildren()) do
                if fx:IsA("BloomEffect")
                or fx:IsA("BlurEffect")
                or fx:IsA("SunRaysEffect")
                or fx:IsA("ColorCorrectionEffect")
                or fx:IsA("DepthOfFieldEffect") then
                    storedEffects[fx] = fx.Enabled
                    fx.Enabled = false
                end
            end
        else
            for o, s in pairs(storedEffects) do
                if o and o.Parent then
                    o.Enabled = s
                end
            end
            storedEffects = {}
        end
    end
})

local InfoTab = Window:CreateTab({
    Name = "Information",
    Icon = "info",
    ImageSource = "Material",
    ShowTitle = true
})

local ClockLabel = InfoTab:CreateLabel({
    Text = "Time: --:--:--",
    Style = 1
})

task.spawn(function()
    while task.wait(1) do
        local t = os.date("*t")
        ClockLabel:SetText(
            string.format("Time: %02d:%02d:%02d", t.hour, t.min, t.sec)
        )
    end
end)

InfoTab:CreateParagraph({
    Title = "Creators",
    Text = "Hydra\nNexus Hub Team"
})

InfoTab:CreateParagraph({
    Title = "Changelog",
    Text = "- Stability\n- Forsaken Support\n- Persistent Noclip"
})

UserInputService.JumpRequest:Connect(function()
    if infJumpEnabled and LocalPlayer.Character then
        local hum = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
        if hum then
            hum:ChangeState(Enum.HumanoidStateType.Jumping)
        end
    end
end)

RunService.Heartbeat:Connect(function()
    if not playerEnabled then return end

    local char = LocalPlayer.Character
    local hrp = char and char:FindFirstChild("HumanoidRootPart")
    local hum = char and char:FindFirstChildOfClass("Humanoid")
    if not hrp or not hum then return end

    workspace.Gravity = gravity

    local dir = hum.MoveDirection
    if dir.Magnitude > 0 then
        hrp.CFrame = hrp.CFrame + (dir * (cframeSpeed * 0.08))
    end
end)
