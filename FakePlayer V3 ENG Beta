local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local ChatService = game:GetService("Chat")
local PathfindingService = game:GetService("PathfindingService")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()

-- INITIAL SETTINGS
local FakeName = "LauraGrassi2"
local fake
local humanoid
local rootPart
local walkTrack
local idleTrack
local jumpTrack
local isResetting = false
local canWalk = true
local MIN_DISTANCE = 5

-- FUNCTION TO CREATE FAKE PLAYER
local function createFake(name)
    if isResetting then return end
    isResetting = true

    -- Safely destroy old fake
    if fake and fake.Parent then
        if walkTrack and walkTrack.IsPlaying then walkTrack:Stop() end
        if idleTrack and idleTrack.IsPlaying then idleTrack:Stop() end
        if jumpTrack and jumpTrack.IsPlaying then jumpTrack:Stop() end
        fake:Destroy()
        fake = nil
        humanoid = nil
        rootPart = nil
        walkTrack = nil
        idleTrack = nil
        jumpTrack = nil
    end

    -- Create humanoid model
    local userId = Players:GetUserIdFromNameAsync(name)
    fake = Players:CreateHumanoidModelFromUserId(userId)
    fake.Name = name
    fake.Parent = workspace
    fake:MoveTo(character.PrimaryPart.Position + Vector3.new(3,0,0))

    humanoid = fake:FindFirstChildOfClass("Humanoid")
    humanoid.WalkSpeed = 16
    humanoid.JumpPower = 50
    humanoid.UseJumpPower = true
    rootPart = fake.PrimaryPart

    -- Animator
    local animator = humanoid:FindFirstChild("Animator")
    if not animator then
        animator = Instance.new("Animator")
        animator.Parent = humanoid
    end

    -- Roblox default idle
    local idleAnim = Instance.new("Animation")
    idleAnim.AnimationId = "rbxassetid://507766666"
    idleTrack = animator:LoadAnimation(idleAnim)
    idleTrack.Priority = Enum.AnimationPriority.Idle
    idleTrack:Play()

    -- Roblox default walk
    local walkAnim = Instance.new("Animation")
    walkAnim.AnimationId = "rbxassetid://507777826"
    walkTrack = animator:LoadAnimation(walkAnim)
    walkTrack.Priority = Enum.AnimationPriority.Movement

    -- Roblox default jump
    local jumpAnim = Instance.new("Animation")
    jumpAnim.AnimationId = "rbxassetid://507777860"
    jumpTrack = animator:LoadAnimation(jumpAnim)
    jumpTrack.Priority = Enum.AnimationPriority.Action

    isResetting = false
end

createFake(FakeName)

-- NORMAL ROBLOX CHAT
local function fakeSay(message)
    if message ~= "" and rootPart then
        ChatService:Chat(rootPart, message, Enum.ChatColor.Blue)
    end
end

-- Player following with Pathfinding
local function followPlayerPathfinding()
    if not humanoid or not rootPart then return end
    local targetPos = character.PrimaryPart.Position

    -- Create path
    local path = PathfindingService:CreatePath({
        AgentRadius = 2,
        AgentHeight = 5,
        AgentCanJump = true,
        AgentJumpHeight = 7,
        AgentMaxSlope = 45
    })
    path:ComputeAsync(rootPart.Position, targetPos)
    local waypoints = path:GetWaypoints()

    for i, waypoint in ipairs(waypoints) do
        if not humanoid or not rootPart then break end

        -- Always look at player
        rootPart.CFrame = CFrame.new(rootPart.Position, Vector3.new(character.PrimaryPart.Position.X, rootPart.Position.Y, character.PrimaryPart.Position.Z))

        -- Auto Jump
        if waypoint.Action == Enum.PathWaypointAction.Jump and humanoid:GetState() ~= Enum.HumanoidStateType.Jumping then
            humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
            if not jumpTrack.IsPlaying then jumpTrack:Play() end
        end

        humanoid:MoveTo(waypoint.Position)
        humanoid.MoveToFinished:Wait()
    end
end

-- Update fake movement each frame
RunService.Heartbeat:Connect(function()
    if not humanoid or not rootPart then return end

    -- Always look at player
    rootPart.CFrame = CFrame.new(rootPart.Position, Vector3.new(character.PrimaryPart.Position.X, rootPart.Position.Y, character.PrimaryPart.Position.Z))

    if not canWalk then
        if walkTrack.IsPlaying then walkTrack:Stop() end
        if not idleTrack.IsPlaying then idleTrack:Play() end
        return
    end

    local distance = (rootPart.Position - character.PrimaryPart.Position).Magnitude

    if distance > MIN_DISTANCE then
        -- Walk
        if not walkTrack.IsPlaying then walkTrack:Play() end
        if idleTrack.IsPlaying then idleTrack:Stop() end
        followPlayerPathfinding()
    else
        -- Stop
        if walkTrack.IsPlaying then walkTrack:Stop() end
        if not idleTrack.IsPlaying then idleTrack:Play() end
    end
end)

-- === UI ===
local ScreenGui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
ScreenGui.ResetOnSpawn = false

local Container = Instance.new("Frame")
Container.Size = UDim2.new(0,360,0,180)
Container.Position = UDim2.new(0,50,0,100)
Container.BackgroundTransparency = 1
Container.Parent = ScreenGui

local Ball = Instance.new("ImageButton")
Ball.Size = UDim2.new(0,50,0,50)
Ball.Position = UDim2.new(0,0,0,0)
Ball.BackgroundColor3 = Color3.fromRGB(255,0,0)
Ball.BorderSizePixel = 0
Ball.Image = ""
Ball.Parent = Container

local FrameUI = Instance.new("Frame")
FrameUI.Size = UDim2.new(0,300,0,160)
FrameUI.Position = UDim2.new(0,60,0,0)
FrameUI.BackgroundColor3 = Color3.fromRGB(50,50,50)
FrameUI.BorderSizePixel = 0
FrameUI.Visible = false
FrameUI.Parent = Container

local TextBox = Instance.new("TextBox", FrameUI)
TextBox.Size = UDim2.new(1,-10,0,40)
TextBox.Position = UDim2.new(0,5,0,5)
TextBox.PlaceholderText = "Type something for the fake to say..."
TextBox.ClearTextOnFocus = false
TextBox.BackgroundColor3 = Color3.fromRGB(70,70,70)
TextBox.TextColor3 = Color3.fromRGB(255,255,255)
TextBox.TextScaled = true

local NameBox = Instance.new("TextBox", FrameUI)
NameBox.Size = UDim2.new(1,-10,0,30)
NameBox.Position = UDim2.new(0,5,0,50)
NameBox.PlaceholderText = "Fake Player Name"
NameBox.Text = FakeName
NameBox.ClearTextOnFocus = false
NameBox.BackgroundColor3 = Color3.fromRGB(70,70,70)
NameBox.TextColor3 = Color3.fromRGB(255,255,255)
